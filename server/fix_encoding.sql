-- 修复数据库编码问题的SQL脚本

-- 1. 删除现有的乱码数据（先删除引用乱码分类的题目，再删除乱码分类）
DELETE FROM questions WHERE category_id IN (1, 2);
DELETE FROM categories WHERE id IN (1, 2); -- 只删除乱码的分类，保留正确的

-- 2. 重置自增ID
ALTER TABLE categories AUTO_INCREMENT = 1;
ALTER TABLE questions AUTO_INCREMENT = 1;

-- 3. 重新插入正确的分类数据
INSERT INTO categories (id, name, parent_id, level, sort) VALUES
(1, '道路交通安全法律、法规', NULL, 1, 1),
(2, '交通信号', NULL, 1, 2),
(3, '安全行车、文明驾驶基础知识', NULL, 1, 3),
(4, '机动车驾驶操作相关基础知识', NULL, 1, 4),
(5, '道路交通安全法律、法规和规章', 1, 2, 1),
(6, '地方性法规', 1, 2, 2),
(7, '道路交通信号灯', 2, 2, 1),
(8, '道路交通标志', 2, 2, 2),
(9, '道路交通标线', 2, 2, 3),
(10, '交通警察手势', 2, 2, 4),
(11, '安全行车常识', 3, 2, 1),
(12, '文明驾驶常识', 3, 2, 2),
(13, '机动车构造常识', 4, 2, 1),
(14, '机动车检验常识', 4, 2, 2);

-- 4. 重新插入示例题目数据
INSERT INTO questions (title, content, options, correct_answer, explanation, difficulty, category_id) VALUES
('机动车驾驶人违法驾驶造成重大交通事故构成犯罪的，依法追究什么责任？', 
 '机动车驾驶人违法驾驶造成重大交通事故构成犯罪的，依法追究什么责任？', 
 '["民事责任", "经济责任", "刑事责任", "直接责任"]', 
 2, 
 '根据《道路交通安全法》规定，违法驾驶造成重大交通事故构成犯罪的，依法追究刑事责任。', 
 'easy', 
 5),

('驾驶机动车在道路上违反道路交通安全法的行为，属于什么行为？', 
 '驾驶机动车在道路上违反道路交通安全法的行为，属于什么行为？', 
 '["违章行为", "违法行为", "过失行为", "违规行为"]', 
 1, 
 '违反道路交通安全法的行为属于违法行为，应当承担相应的法律责任。', 
 'easy', 
 5),

('机动车驾驶证有效期满换证时，需要提交什么？', 
 '机动车驾驶证有效期满换证时，需要提交什么？', 
 '["机动车登记证书", "机动车保险单", "身体条件证明", "机动车技术检验合格证明"]', 
 2, 
 '驾驶证有效期满换证时，需要提交身体条件证明，确保驾驶人身体状况符合驾驶要求。', 
 'medium', 
 5),

('这个标志是何含义？', 
 '这个标志是何含义？（假设显示禁止通行标志）', 
 '["禁止通行", "禁止驶入", "禁止车辆临时停放", "禁止车辆长时停放"]', 
 0, 
 '红色圆形标志表示禁止通行，任何车辆和行人都不得通过。', 
 'easy', 
 8),

('这个标志是何含义？', 
 '这个标志是何含义？（假设显示限速标志）', 
 '["最低限速60公里/小时", "最高限速60公里/小时", "解除限速60公里/小时", "建议速度60公里/小时"]', 
 1, 
 '圆形标志内显示数字表示最高限速，此标志表示最高限速60公里/小时。', 
 'medium', 
 8),

('在冰雪道路上行车时，车辆的稳定性降低，加速过急时车轮极易空转或溜滑。', 
 '在冰雪道路上行车时，车辆的稳定性降低，加速过急时车轮极易空转或溜滑。', 
 '["正确", "错误"]', 
 0, 
 '在冰雪道路上，路面摩擦力减小，车辆稳定性确实会降低，加速过急容易导致车轮空转或溜滑。', 
 'easy', 
 11),

('驾驶机动车在雾天行车开启雾灯和危险报警闪光灯。', 
 '驾驶机动车在雾天行车开启雾灯和危险报警闪光灯。', 
 '["正确", "错误"]', 
 0, 
 '雾天行车应当开启雾灯和危险报警闪光灯，提高车辆的可见性，确保行车安全。', 
 'easy', 
 11),

('机动车仪表板上（如图所示）亮表示什么？', 
 '机动车仪表板上（如图所示）亮表示什么？（假设显示发动机故障灯）', 
 '["发动机故障", "燃油不足", "充电故障", "冷却液不足"]', 
 0, 
 '发动机故障指示灯亮起表示发动机系统出现故障，应及时检修。', 
 'medium', 
 13),

('机动车在高速公路上发生故障时，在来车方向50至100米处设置警告标志。', 
 '机动车在高速公路上发生故障时，在来车方向50至100米处设置警告标志。', 
 '["正确", "错误"]', 
 1, 
 '在高速公路上发生故障时，应在来车方向150米以外设置警告标志，而不是50至100米。', 
 'hard', 
 11),

('申请机动车驾驶证的人，应当符合国务院公安部门规定的驾驶许可条件。', 
 '申请机动车驾驶证的人，应当符合国务院公安部门规定的驾驶许可条件。', 
 '["正确", "错误"]', 
 0, 
 '根据《道路交通安全法》规定，申请驾驶证的人应当符合国务院公安部门规定的驾驶许可条件。', 
 'easy', 
 5);

-- 5. 显示修复结果
SELECT '分类数据修复完成' as message;
SELECT id, name, level, sort FROM categories ORDER BY level, sort;
SELECT '题目数据修复完成' as message;
SELECT COUNT(*) as total_questions FROM questions;